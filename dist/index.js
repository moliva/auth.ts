"use strict";var d=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.prototype.hasOwnProperty;var T=(e,n)=>{for(var o in n)d(e,o,{get:n[o],enumerable:!0})},x=(e,n,o,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of g(n))!m.call(e,t)&&t!==o&&d(e,t,{get:()=>n[t],enumerable:!(i=h(n,t))||i.enumerable});return e};var k=e=>x(d({},"__esModule",{value:!0}),e);var y={};T(y,{AUTH_HOST:()=>s,ID_TOKEN_COOKIE:()=>f,authentifiedFetch:()=>p,getCookie:()=>a,handleAuth:()=>C,logout:()=>l,removeCookie:()=>w,setAuthConfig:()=>A,setCookie:()=>S});module.exports=k(y);function w(e){document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`}function a(e){let n=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let t=0;t<i.length;t++){let r=i[t];for(;r.charAt(0)==" ";)r=r.substring(1);if(r.indexOf(n)==0)return r.substring(n.length,r.length)}return null}function S(e,n,o){let i="";if(o){let t=new Date;t.setTime(t.getTime()+o*24*60*60*1e3),i=`;expires=${t.toUTCString()}`}document.cookie=`${e}=${n};SameSite=Strict;Secure;path=/${i}`}var f="id_token";function C(e,n){if(!e().identity){let o,i=a(f);if(i!==null){let t=i.split(".")[1],r=atob(t);o=JSON.parse(r)}if(o){let t={identity:o};n({...e(),identity:t})}}}var s,u;function A({api:e,web:n}){s=e,u=n}async function l(){return await p(`${s}/logout`,{redirect:"manual"})}var c=!1;async function p(e,n={}){if(!s)throw new Error("API_HOST not set");let o={...n,mode:"cors",cache:"no-cache",credentials:"include"},i=await fetch(e,o);if(i.status===401){if(c)for(;c;)await new Promise(t=>setTimeout(t,100));else{c=!0;let t;try{t=await I(o)}catch{}if(!t?.ok)return await l(),location.assign(u),i;c=!1}return await fetch(e,o)}else return i}async function I(e){return await fetch(`${s}/refresh`,{...e,method:"POST"})}0&&(module.exports={AUTH_HOST,ID_TOKEN_COOKIE,authentifiedFetch,getCookie,handleAuth,logout,removeCookie,setAuthConfig,setCookie});
