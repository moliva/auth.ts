function h(t){document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`}function d(t){let i=t+"=",n=decodeURIComponent(document.cookie).split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;r.charAt(0)==" ";)r=r.substring(1);if(r.indexOf(i)==0)return r.substring(i.length,r.length)}return null}function g(t,i,o){let n="";if(o){let e=new Date;e.setTime(e.getTime()+o*24*60*60*1e3),n=`;expires=${e.toUTCString()}`}document.cookie=`${t}=${i};SameSite=Strict;Secure;path=/${n}`}var f="id_token";function x(t,i){if(!t().identity){let o,n=d(f);if(n!==null){let e=n.split(".")[1],r=atob(e);o=JSON.parse(r)}if(o){let e={identity:o};i({...t(),identity:e})}}}var c,a;function w({api:t,web:i}){c=t,a=i}async function u(){return await l(`${c}/logout`,{redirect:"manual"})}var s=!1;async function l(t,i={}){if(!c)throw new Error("API_HOST not set");let o={...i,mode:"cors",cache:"no-cache",credentials:"include"},n=await fetch(t,o);if(n.status===401){if(s)for(;s;)await new Promise(e=>setTimeout(e,100));else{s=!0;let e;try{e=await p(o)}catch{}if(!e?.ok)return await u(),location.assign(a),n;s=!1}return await fetch(t,o)}else return n}async function p(t){return await fetch(`${c}/refresh`,{...t,method:"POST"})}export{c as AUTH_HOST,f as ID_TOKEN_COOKIE,l as authentifiedFetch,d as getCookie,x as handleAuth,u as logout,h as removeCookie,w as setAuthConfig,g as setCookie};
